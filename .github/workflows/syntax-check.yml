name: Syntax Check

on:
  push:
  pull_request:

jobs:
  python-syntax:
    name: Python Syntax
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Check Python syntax
        run: |
          python - <<'PY'
          import pathlib
          import py_compile
          import sys

          excluded_dirs = {".git", ".venv", "node_modules", "__pycache__"}
          failed = False

          for path in pathlib.Path(".").rglob("*.py"):
              if any(part in excluded_dirs for part in path.parts):
                  continue
              try:
                  py_compile.compile(str(path), doraise=True)
              except Exception as exc:
                  failed = True
                  print(f"{path}: {exc}")

          if failed:
              sys.exit(1)

          print("Python syntax check passed.")
          PY

  typescript-syntax:
    name: TypeScript Syntax
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: "npm"

      - name: Install dependencies
        run: npm ci

      - name: Check TypeScript syntax
        run: npx tsc --noEmit
